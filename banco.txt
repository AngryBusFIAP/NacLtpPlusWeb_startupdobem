CREATE TABLE T_SCN_PESSOA (
  ID_PESSOA       NUMERIC(5),
  NM_PESSOA       VARCHAR2(120) NOT NULL,
  DT_NASC         DATE          NOT NULL,
  TX_EMAIL        VARCHAR2(50)  NOT NULL,
  NM_USER         VARCHAR2(16)  NOT NULL,
  TX_SENHA        VARCHAR2(12)  NOT NULL,
  DT_CADASTRO     DATE DEFAULT CURRENT_TIMESTAMP,
  NM_ACEITATERMOS NUMERIC(1) NOT NULL,
  PRIMARY KEY (ID_PESSOA)
);

CREATE TABLE T_SCN_CLIENTE (
  ID_CLIENTE NUMERIC(5),
  NR_CPF     NUMERIC(11)  NOT NULL,
  NR_RG      VARCHAR2(10) NOT NULL,
  --CONSTRAINT CHECK SEXO ('M', 'F')
  TX_SEXO    CHAR(1)      NOT NULL,
  PRIMARY KEY (ID_CLIENTE)
);

ALTER TABLE T_SCN_CLIENTE
ADD CONSTRAINT PFK_PESSOA FOREIGN KEY (ID_CLIENTE) REFERENCES T_SCN_PESSOA (ID_PESSOA);

CREATE TABLE T_SCN_EMPRESA (
  ID_EMPRESA NUMERIC(5),
  NR_CNPJ    NUMERIC(15)  NOT NULL,
  NR_INSCEST NUMERIC(12)  NOT NULL,
  NM_CONTATO VARCHAR2(40) NOT NULL,
  PRIMARY KEY (ID_EMPRESA)
);

ALTER TABLE T_SCN_EMPRESA
ADD CONSTRAINT PFK_EMPRESA FOREIGN KEY (ID_EMPRESA) REFERENCES T_SCN_PESSOA (ID_PESSOA);


CREATE TABLE T_SCN_ENDERECO (
  ID_END         NUMERIC(20),
  NM_LOG         VARCHAR2(80) NOT NULL,
  NR_LOG         NUMERIC(7)   NOT NULL,
  TX_COMPLEMENTO VARCHAR2(30),
  NR_CEP VARCHAR2(8) NOT NULL,
  NM_BAIRRO      VARCHAR2(30) NOT NULL,
  NM_CIDADE      VARCHAR2(30) NOT NULL,
  SG_ESTADO      CHAR(2)      NOT NULL,
  ID_PESSOA      NUMERIC(5),
  PRIMARY KEY (ID_END)
);

ALTER TABLE T_SCN_ENDERECO
ADD CONSTRAINT FK_PESSOA_END FOREIGN KEY (ID_PESSOA) REFERENCES T_SCN_PESSOA (ID_PESSOA);

CREATE TABLE T_SCN_TELEFONE (
  ID_TEL     NUMERIC(5),
  -- NR_CODPAIS NUMERIC(3) NOT NULL,
  NR_DDD     NUMERIC(2) NOT NULL,
  NR_TEL     NUMERIC(9) NOT NULL,
  --  NR_RAMAL   NUMERIC(10),
  ID_PESSOA  NUMERIC(5),
  PRIMARY KEY (ID_TEL)
);

ALTER TABLE T_SCN_TELEFONE
ADD CONSTRAINT FK_PESSOA_TEL FOREIGN KEY (ID_PESSOA) REFERENCES T_SCN_PESSOA (ID_PESSOA);

CREATE TABLE T_SCN_REGIAO (
  ID_REGIAO NUMERIC(5),
  NM_REGIAO CHAR(2) NOT NULL,
  PRIMARY KEY (ID_REGIAO)
);

CREATE TABLE T_SCN_EMPRESA_REGIAO (
  ID_EMPRESA NUMERIC(5),
  ID_REGIAO  NUMERIC(5),
  PRIMARY KEY (ID_EMPRESA, ID_REGIAO)
);

ALTER TABLE T_SCN_EMPRESA_REGIAO
  ADD CONSTRAINT PFK_EMPRESA_REG FOREIGN KEY (ID_EMPRESA) REFERENCES T_SCN_EMPRESA (ID_EMPRESA);

ALTER TABLE T_SCN_EMPRESA_REGIAO
  ADD CONSTRAINT PFK_REGIAO_EMP FOREIGN KEY (ID_REGIAO) REFERENCES T_SCN_REGIAO (ID_REGIAO);

CREATE TABLE T_SCN_ITINERARIO (
  ID_ITINERARIO NUMERIC(5),
  NM_ITINERARIO VARCHAR2(20) NOT NULL,
  ID_EMPRESA    NUMERIC(5),
  ID_REGIAO     NUMERIC(5),
  PRIMARY KEY (ID_ITINERARIO)
);

ALTER TABLE T_SCN_ITINERARIO
  ADD CONSTRAINT FK_EMPRESA_ITI FOREIGN KEY (ID_EMPRESA) REFERENCES T_SCN_EMPRESA (ID_EMPRESA);

ALTER TABLE T_SCN_ITINERARIO
  ADD CONSTRAINT FK_REGIAO_ITI FOREIGN KEY (ID_REGIAO) REFERENCES T_SCN_REGIAO (ID_REGIAO);

CREATE TABLE T_SCN_RECLAMACAO (
  ID_RECLAMACAO    NUMERIC(10),
  DT_OCORRENCIA    DATE           NOT NULL,
  HR_OCORRENCIA    NUMERIC(4)     NOT NULL,

  /*CONSTRAINT CHECK SOBRE OS SENTIDOS
  B -> Bairro/Terminal sentido Bairro
  T -> Centro/Terminal sentido Centro
  M -> Metro/CPTM
  C -> Circular
   */
  TX_SENTIDOVIAGEM CHAR(1)        NOT NULL,
  NR_NOTAPRERECLAM NUMERIC(1)     NOT NULL,

  --Constraint Default = 0
  NR_NOTAPOSRECLAM NUMERIC(1),
  DT_RECLAMACAO    DATE DEFAULT CURRENT_TIMESTAMP,
  TX_RECLAMACAO    VARCHAR2(3000) NOT NULL,
  TX_OBSERVACAO    VARCHAR2(1000),
  ID_REGIAO        NUMERIC(5),
  ID_CLIENTE       NUMERIC(5),
  ID_EMPRESA       NUMERIC(5),
  ID_ITINERARIO    VARCHAR2(10),
  PRIMARY KEY (ID_RECLAMACAO)
);


ALTER TABLE T_SCN_RECLAMACAO
  ADD CONSTRAINT FK_REGIAO_REC FOREIGN KEY (ID_REGIAO) REFERENCES T_SCN_REGIAO (ID_REGIAO);

ALTER TABLE T_SCN_RECLAMACAO
  ADD CONSTRAINT FK_CLIENTE_REC FOREIGN KEY (ID_CLIENTE) REFERENCES T_SCN_CLIENTE (ID_CLIENTE);

ALTER TABLE T_SCN_RECLAMACAO
  ADD CONSTRAINT FK_EMPRESA_REC FOREIGN KEY (ID_EMPRESA) REFERENCES T_SCN_EMPRESA (ID_EMPRESA);

ALTER TABLE T_SCN_RECLAMACAO
  ADD CONSTRAINT FK_ITINERARIO_REC FOREIGN KEY (ID_ITINERARIO) REFERENCES T_SCN_ITINERARIO (ID_ITINERARIO);

CREATE TABLE T_SCN_RANKING (
  ID_RECLAMACAO NUMERIC(10),
  ID_REGIAO     NUMERIC(5),
  ID_ITINERARIO NUMERIC(5),
  PRIMARY KEY (ID_RECLAMACAO, ID_REGIAO, ID_ITINERARIO)
);

ALTER TABLE T_SCN_RANKING
  ADD CONSTRAINT PFK_RECLAM_RAN FOREIGN KEY (ID_RECLAMACAO) REFERENCES T_SCN_RECLAMACAO (ID_RECLAMACAO);

ALTER TABLE T_SCN_RANKING
  ADD CONSTRAINT PFK_REGIAO_RAN FOREIGN KEY (ID_REGIAO) REFERENCES T_SCN_REGIAO (ID_REGIAO);

ALTER TABLE T_SCN_RANKING
  ADD CONSTRAINT PFK_ITINERARIO_RAN FOREIGN KEY (ID_ITINERARIO) REFERENCES T_SCN_ITINERARIO (ID_ITINERARIO);

CREATE TABLE T_SCN_RESPOSTA (
  ID_RESPOSTA NUMERIC(15),
  ID_CLIENTE  NUMERIC(5),
  ID_EMPRESA  NUMERIC(5),
  TX_RESPOSTA VARCHAR2(2000),
  PRIMARY KEY (ID_RESPOSTA)
);

ALTER TABLE T_SCN_RESPOSTA
  ADD CONSTRAINT PFK_CLIENTE_RES FOREIGN KEY (ID_CLIENTE) REFERENCES T_SCN_CLIENTE (ID_CLIENTE);

ALTER TABLE T_SCN_RESPOSTA
  ADD CONSTRAINT PFK_EMPRESA_RES FOREIGN KEY (ID_EMPRESA) REFERENCES T_SCN_EMPRESA (ID_EMPRESA);

CREATE TABLE T_SCN_RECLAMACAO_RESPOSTA (
  ID_RESPOSTA NUMERIC(15),
  ID_CLIENTE  NUMERIC(5),
  ID_EMPRESA  NUMERIC(5),
  TX_RESPOSTA VARCHAR2(1000),
  PRIMARY KEY (ID_RESPOSTA)
);

ALTER TABLE T_SCN_RECLAMACAO_RESPOSTA
  ADD CONSTRAINT FK_CLIENTE_RRE FOREIGN KEY (ID_CLIENTE) REFERENCES T_SCN_CLIENTE (ID_CLIENTE);

ALTER TABLE T_SCN_RECLAMACAO_RESPOSTA
  ADD CONSTRAINT FK_EMPRESA_RRE FOREIGN KEY (ID_EMPRESA) REFERENCES T_SCN_EMPRESA (ID_EMPRESA);

--TODO Adicionar as Constraints de Check Unique Default

ALTER TABLE T_SCN_RECLAMACAO
  ADD CONSTRAINT CK_TX_SENTIDOVIAGEM CHECK (UPPER(tx_sentidoviagem) IN ('B', 'T', 'M', 'C'));

ALTER TABLE T_SCN_REGIAO
  ADD CONSTRAINT ck_nm_regiao CHECK (UPPER(nm_regiao) IN
                                   ('N', 'NO', 'NE', 'S', 'SE', 'SO', 'O', 'C', 'CO', 'L'));

ALTER TABLE T_SCN_PESSOA
  ADD CONSTRAINT ck_dt_nasc CHECK (dt_nasc < '01/01/1999');

ALTER TABLE T_SCN_CLIENTE
  ADD CONSTRAINT ck_tx_sexo CHECK(UPPER(tx_sexo) IN ('M', 'F'));

ALTER TABLE T_SCN_CLIENTE
  ADD CONSTRAINT ck_nr_cpf UNIQUE(nr_cpf);

ALTER TABLE T_SCN_CLIENTE
  ADD CONSTRAINT ck_nr_rg UNIQUE(nr_rg);

ALTER TABLE T_SCN_CLIENTE
  ADD CONSTRAINT ck_nm_user UNIQUE(nm_user);

ALTER TABLE T_SCN_EMPRESA
  ADD CONSTRAINT ck_nr_cnpj UNIQUE(nr_cnpj);

/*
  SequÃªncias / Lembrar de colocar no DAO
*/
CREATE SEQUENCE SQ_SCN_CLIENTE
  INCREMENT BY 1
  START WITH 1
  MAXVALUE 999
  NOCACHE
  NOCYCLE;

CREATE SEQUENCE SQ_SCN_RECLAMACAO
  INCREMENT BY 1
  START WITH 1
  MAXVALUE 999
  NOCACHE
  NOCYCLE;

CREATE SEQUENCE SQ_SCN_PESSOA
  INCREMENT BY 1
  START WITH 1
  MAXVALUE 999
  NOCACHE
  NOCYCLE;

CREATE SEQUENCE SQ_SCN_ENDERECO
  INCREMENT BY 1
  START WITH 1
  MAXVALUE 999
  NOCACHE
  NOCYCLE;

CREATE SEQUENCE SQ_SCN_TELEFONE
  INCREMENT BY 1
  START WITH 1
  MAXVALUE 999
  NOCACHE
  NOCYCLE;

CREATE SEQUENCE SQ_SCN_ITINERARIO
  INCREMENT BY 1
  START WITH 1
  MAXVALUE 999
  NOCACHE
  NOCYCLE;

CREATE SEQUENCE SQ_SCN_REGIAO
INCREMENT BY 1
START WITH 1
MAXVALUE 10
NOCACHE
NOCYCLE;
